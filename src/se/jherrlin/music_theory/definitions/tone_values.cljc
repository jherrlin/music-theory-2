(ns se.jherrlin.music-theory.definitions.tone-values)


(comment
  (->> (let [tones       [#{:c}
                          #{:db :c#}
                          #{:d}
                          #{:d# :eb}
                          #{:e}
                          #{:f}
                          #{:gb :f#}
                          #{:g}
                          #{:g# :ab}
                          #{:a}
                          #{:bb :a#}
                          #{:b}]
             nr-of-tones (count tones)]
         (loop [[current-tone & rest] (apply concat (take (* nr-of-tones 7) (repeat tones)))
                value-coounter        0
                octave-counter        0
                acc                   {}]
           (if (= octave-counter 12)
             acc
             (recur
              rest
              (inc value-coounter)
              (if (current-tone :b) (inc octave-counter) octave-counter)
              (reduce
               (fn [m tone]
                 (assoc m
                        [tone octave-counter] value-coounter
                        [current-tone octave-counter] value-coounter))
               acc
               current-tone)))))
       #_(sort-by second))
  )

(defn vec-remove
  "remove elem in coll"
  [idx coll]
  (into (subvec coll 0 idx) (subvec coll (inc idx))))

(def tone-values
  {[:db 11] 133,
   [#{:d} 2] 26,
   [#{:f} 6] 77,
   [:c 9] 108,
   [:e 4] 52,
   [#{:d} 9] 110,
   [:d# 8] 99,
   [:d 8] 98,
   [:a# 4] 58,
   [:g# 5] 68,
   [#{:g} 2] 31,
   [#{:a} 0] 9,
   [#{:f} 2] 29,
   [#{:c} 9] 108,
   [#{:b} 10] 131,
   [:bb 9] 118,
   [:a 2] 33,
   [:eb 10] 123,
   [#{:d} 3] 38,
   [:d 9] 110,
   [:d# 2] 27,
   [#{:bb :a#} 9] 118,
   [#{:f} 4] 53,
   [:ab 10] 128,
   [#{:gb :f#} 10] 126,
   [:g 10] 127,
   [#{:a} 11] 141,
   [:d# 1] 15,
   [:bb 1] 22,
   [:c# 0] 1,
   [#{:g} 6] 79,
   [#{:db :c#} 6] 73,
   [:a 11] 141,
   [#{:db :c#} 10] 121,
   [:c# 10] 121,
   [:g# 4] 56,
   [:a# 2] 34,
   [:g# 11] 140,
   [:b 6] 83,
   [:f 10] 125,
   [#{:g} 9] 115,
   [:a 10] 129,
   [:bb 5] 70,
   [#{:b} 8] 107,
   [:b 9] 119,
   [:d# 9] 111,
   [:f 0] 5,
   [#{:d# :eb} 1] 15,
   [#{:gb :f#} 11] 138,
   [#{:g# :ab} 0] 8,
   [:f 11] 137,
   [#{:db :c#} 11] 133,
   [:gb 2] 30,
   [:g 9] 115,
   [:g# 9] 116,
   [:e 3] 40,
   [:g 11] 139,
   [#{:bb :a#} 4] 58,
   [#{:e} 2] 28,
   [#{:db :c#} 2] 25,
   [#{:f} 0] 5,
   [#{:d} 4] 50,
   [:c 8] 96,
   [#{:gb :f#} 2] 30,
   [:d 6] 74,
   [:bb 10] 130,
   [:g# 3] 44,
   [:db 2] 25,
   [:db 5] 61,
   [#{:d} 11] 134,
   [:e 9] 112,
   [:f 5] 65,
   [#{:g# :ab} 6] 80,
   [:d# 7] 87,
   [:db 0] 1,
   [:d 2] 26,
   [:eb 3] 39,
   [#{:d} 0] 2,
   [#{:gb :f#} 0] 6,
   [:c# 4] 49,
   [#{:g} 7] 91,
   [:g 7] 91,
   [#{:bb :a#} 8] 106,
   [#{:d} 8] 98,
   [#{:e} 10] 124,
   [:ab 11] 140,
   [:g# 2] 32,
   [:f# 6] 78,
   [:g# 7] 92,
   [:g# 6] 80,
   [:a# 1] 22,
   [:f 3] 41,
   [:a# 10] 130,
   [:e 6] 76,
   [#{:c} 8] 96,
   [:bb 11] 142,
   [:gb 11] 138,
   [:d 10] 122,
   [:a 4] 57,
   [#{:g} 4] 55,
   [:db 4] 49,
   [#{:c} 0] 0,
   [:f 2] 29,
   [#{:f} 8] 101,
   [:f 7] 89,
   [#{:f} 3] 41,
   [:db 7] 85,
   [:g 1] 19,
   [:eb 6] 75,
   [:c 5] 60,
   [:a# 6] 82,
   [:gb 3] 42,
   [:c# 6] 73,
   [:g 3] 43,
   [#{:db :c#} 4] 49,
   [:a 7] 93,
   [#{:a} 6] 81,
   [#{:g} 1] 19,
   [:c 1] 12,
   [#{:f} 5] 65,
   [:g 5] 67,
   [:eb 4] 51,
   [:c 2] 24,
   [:bb 4] 58,
   [:e 8] 100,
   [#{:f} 1] 17,
   [:a 3] 45,
   [#{:bb :a#} 10] 130,
   [:g 4] 55,
   [:a 0] 9,
   [:b 8] 107,
   [:d# 3] 39,
   [#{:a} 7] 93,
   [:f# 2] 30,
   [#{:a} 8] 105,
   [:c# 3] 37,
   [#{:e} 5] 64,
   [#{:g# :ab} 2] 32,
   [:f 1] 17,
   [#{:e} 1] 16,
   [:d 4] 50,
   [:f# 4] 54,
   [#{:gb :f#} 8] 102,
   [:db 8] 97,
   [:g# 10] 128,
   [#{:e} 8] 100,
   [:d# 6] 75,
   [:bb 7] 94,
   [#{:db :c#} 7] 85,
   [#{:gb :f#} 9] 114,
   [:g 6] 79,
   [#{:c} 6] 72,
   [#{:d# :eb} 8] 99,
   [#{:d# :eb} 10] 123,
   [:eb 11] 135,
   [:db 1] 13,
   [:f# 11] 138,
   [#{:a} 2] 33,
   [:c 7] 84,
   [:g 8] 103,
   [:g# 1] 20,
   [:a# 11] 142,
   [#{:bb :a#} 3] 46,
   [:c 0] 0,
   [:d 7] 86,
   [#{:a} 5] 69,
   [:c 10] 120,
   [:a# 0] 10,
   [#{:f} 10] 125,
   [:e 5] 64,
   [#{:c} 5] 60,
   [:db 9] 109,
   [#{:d# :eb} 6] 75,
   [#{:g} 8] 103,
   [#{:gb :f#} 4] 54,
   [:c# 5] 61,
   [:f# 10] 126,
   [:c 3] 36,
   [:c# 8] 97,
   [:b 0] 11,
   [#{:g# :ab} 7] 92,
   [:c# 9] 109,
   [:a 8] 105,
   [:c# 2] 25,
   [:bb 3] 46,
   [#{:gb :f#} 7] 90,
   [#{:g} 5] 67,
   [#{:g# :ab} 5] 68,
   [#{:gb :f#} 3] 42,
   [:b 2] 35,
   [:gb 7] 90,
   [:f# 0] 6,
   [:ab 0] 8,
   [#{:gb :f#} 1] 18,
   [:f# 3] 42,
   [:ab 3] 44,
   [:db 3] 37,
   [:e 7] 88,
   [:ab 7] 92,
   [:d 0] 2,
   [:gb 6] 78,
   [:d# 4] 51,
   [#{:a} 1] 21,
   [:e 2] 28,
   [#{:bb :a#} 1] 22,
   [#{:d# :eb} 2] 27,
   [:ab 5] 68,
   [:g# 0] 8,
   [#{:g# :ab} 3] 44,
   [#{:d# :eb} 3] 39,
   [:f 6] 77,
   [:gb 4] 54,
   [:a 1] 21,
   [#{:g} 11] 139,
   [#{:d} 7] 86,
   [:f# 1] 18,
   [:a# 5] 70,
   [:gb 10] 126,
   [#{:d} 1] 14,
   [#{:c} 3] 36,
   [#{:gb :f#} 5] 66,
   [#{:g# :ab} 11] 140,
   [:gb 1] 18,
   [:c# 1] 13,
   [:f 9] 113,
   [:b 11] 143,
   [:ab 6] 80,
   [:ab 1] 20,
   [#{:d} 6] 74,
   [:d# 5] 63,
   [:b 7] 95,
   [:ab 2] 32,
   [:eb 1] 15,
   [:e 11] 136,
   [#{:c} 1] 12,
   [#{:b} 2] 35,
   [#{:e} 6] 76,
   [#{:bb :a#} 11] 142,
   [#{:e} 4] 52,
   [:gb 9] 114,
   [#{:e} 11] 136,
   [:gb 5] 66,
   [#{:b} 9] 119,
   [:ab 4] 56,
   [#{:d# :eb} 7] 87,
   [#{:e} 0] 4,
   [#{:g# :ab} 9] 116,
   [:eb 5] 63,
   [:d# 0] 3,
   [:eb 2] 27,
   [:b 10] 131,
   [#{:g} 0] 7,
   [:c# 7] 85,
   [:ab 8] 104,
   [:d# 11] 135,
   [:f# 7] 90,
   [:e 1] 16,
   [:b 5] 71,
   [#{:c} 7] 84,
   [#{:g# :ab} 1] 20,
   [:b 4] 59,
   [#{:b} 1] 23,
   [:a 6] 81,
   [#{:bb :a#} 0] 10,
   [:bb 6] 82,
   [#{:c} 10] 120,
   [#{:a} 3] 45,
   [:e 10] 124,
   [#{:f} 7] 89,
   [:a# 3] 46,
   [#{:db :c#} 1] 13,
   [#{:b} 4] 59,
   [#{:db :c#} 3] 37,
   [#{:d# :eb} 4] 51,
   [#{:a} 4] 57,
   [#{:b} 0] 11,
   [#{:b} 6] 83,
   [#{:g# :ab} 10] 128,
   [:g# 8] 104,
   [#{:d# :eb} 11] 135,
   [:gb 0] 6,
   [:c 4] 48,
   [:f 8] 101,
   [:a 5] 69,
   [:c 6] 72,
   [:eb 9] 111,
   [#{:b} 7] 95,
   [:bb 8] 106,
   [#{:e} 3] 40,
   [:e 0] 4,
   [:eb 0] 3,
   [#{:a} 9] 117,
   [#{:f} 11] 137,
   [:c# 11] 133,
   [:f# 5] 66,
   [#{:bb :a#} 5] 70,
   [#{:g} 3] 43,
   [:gb 8] 102,
   [:g 0] 7,
   [:a 9] 117,
   [:db 6] 73,
   [#{:db :c#} 0] 1,
   [#{:bb :a#} 7] 94,
   [:db 10] 121,
   [:d 3] 38,
   [#{:b} 11] 143,
   [#{:bb :a#} 6] 82,
   [:a# 8] 106,
   [#{:d# :eb} 0] 3,
   [#{:db :c#} 5] 61,
   [#{:d} 10] 122,
   [:f 4] 53,
   [:g 2] 31,
   [#{:c} 2] 24,
   [#{:d# :eb} 5] 63,
   [:b 3] 47,
   [#{:a} 10] 129,
   [#{:f} 9] 113,
   [#{:c} 4] 48,
   [:b 1] 23,
   [:d 5] 62,
   [:eb 8] 99,
   [:f# 9] 114,
   [#{:db :c#} 9] 109,
   [:c 11] 132,
   [:a# 9] 118,
   [#{:e} 7] 88,
   [#{:g# :ab} 4] 56,
   [:d 11] 134,
   [#{:c} 11] 132,
   [#{:b} 5] 71,
   [#{:d} 5] 62,
   [:d# 10] 123,
   [:d 1] 14,
   [:a# 7] 94,
   [:ab 9] 116,
   [:f# 8] 102,
   [:eb 7] 87,
   [:bb 0] 10,
   [#{:g} 10] 127,
   [#{:g# :ab} 8] 104,
   [:bb 2] 34,
   [#{:db :c#} 8] 97,
   [#{:gb :f#} 6] 78,
   [#{:d# :eb} 9] 111,
   [#{:e} 9] 112,
   [#{:bb :a#} 2] 34,
   [#{:b} 3] 47})

(defn get-tone-value [tone octave]
  (get tone-values [tone octave]))

(get-tone-value :b 2) ;; => 35
(get-tone-value :c 3) ;; => 36
(get-tone-value #{:c} 3)

(defn compare-tones [[t1 o1] [t2 o2]]
  (- (get-tone-value t1 o1)
     (get-tone-value t2 o2)))

(compare-tones [:b 2] [:c 3])
(compare-tones [#{:c} 3] [#{:e} 3])

(let [tones [[#{:c} 3] [#{:e} 3] [#{:g} 3] [#{:c} 4] [#{:e} 4]]]
  (=
   tones
   (vec (sort-by compare-tones tones))))

(defn drop-2 [tones]
  (let [[tone octave] (nth tones 1)
        tones' (vec-remove 1 tones)]
    (conj tones' [tone (inc octave)])))

(defn undo-drop-2 [tones]
  (let [[tone octave] (nth tones 3)]
    [(nth tones 0) [tone (dec octave)] (nth tones 1) (nth tones 2)]))



(let [stacked-tones-in-chord [[#{:d} 3]
                              [#{:gb :f#} 3]
                              [#{:a} 3]
                              [#{:db :c#} 4]]
      drop-2-voicing         [[#{:d} 3]
                              [#{:a} 3]
                              [#{:db :c#} 4]
                              [#{:gb :f#} 4]]]
  (= (drop-2 stacked-tones-in-chord)
     drop-2-voicing))

;; Dmaj7 stacked
(let [stacked-tones-in-chord [[#{:d} 3]
                              [#{:gb :f#} 3]
                              [#{:a} 3]
                              [#{:db :c#} 4]]]
  (->> stacked-tones-in-chord
       (drop-2)
       (undo-drop-2)
       (= stacked-tones-in-chord)))
